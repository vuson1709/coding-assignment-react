"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.webpackInitSchematic = exports.webpackInitGenerator = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
const run_tasks_in_serial_1 = require("@nrwl/workspace/src/utilities/run-tasks-in-serial");
const versions_1 = require("@nrwl/js/src/utils/versions");
const versions_2 = require("../../utils/versions");
const add_babel_inputs_1 = require("@nrwl/js/src/utils/add-babel-inputs");
function webpackInitGenerator(tree, schema) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const tasks = [];
        if (schema.compiler === 'babel') {
            (0, add_babel_inputs_1.addBabelInputs)(tree);
        }
        if (schema.compiler === 'swc') {
            const swcInstallTask = (0, devkit_1.addDependenciesToPackageJson)(tree, {}, {
                '@swc/helpers': versions_2.swcHelpersVersion,
                '@swc/core': versions_1.swcCoreVersion,
                'swc-loader': versions_2.swcLoaderVersion,
            });
            tasks.push(swcInstallTask);
        }
        if (schema.compiler === 'tsc') {
            const tscInstallTask = (0, devkit_1.addDependenciesToPackageJson)(tree, {}, { tslib: versions_2.tsLibVersion });
            tasks.push(tscInstallTask);
        }
        if (schema.uiFramework === 'react') {
            const reactInstallTask = (0, devkit_1.addDependenciesToPackageJson)(tree, {}, {
                '@pmmmwh/react-refresh-webpack-plugin': versions_2.reactRefreshWebpackPluginVersion,
                '@svgr/webpack': versions_2.svgrWebpackVersion,
                'react-refresh': versions_2.reactRefreshVersion,
                'url-loader': versions_2.urlLoaderVersion,
            });
            tasks.push(reactInstallTask);
        }
        if (!schema.skipFormat) {
            yield (0, devkit_1.formatFiles)(tree);
        }
        return (0, run_tasks_in_serial_1.runTasksInSerial)(...tasks);
    });
}
exports.webpackInitGenerator = webpackInitGenerator;
exports.default = webpackInitGenerator;
exports.webpackInitSchematic = (0, devkit_1.convertNxGenerator)(webpackInitGenerator);
//# sourceMappingURL=init.js.map